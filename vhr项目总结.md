## 重构vhr的内容

### 布隆过滤器

（可以吹的点）

- 原理（多hash解决多冲突问题
- 缺点（删除key需要重构布隆过滤器
- 改进（采用桶排序思想计数
- 改进的缺点（空间复杂从n变2的n次幂

### 单点问题

（可以吹的点）

- 单点带来的问题（单点故障、容量有限、可支持的连接有限
- 微服务查分原则AFK
  - x：主从、主备（复制解决一个挂逼的问题）
  - y：业务拆分，根据功能、业务分成多台（解决容量有限的问题，*一定程度上解决性能问题*）
  - z：hash拆分，决定同一业务的不同key应该存取到哪台实例
- cap理论
  - patition：因为网络通讯不流畅，导致连接不通，系统被分割为几个数据区域
  - consistency：一致性
  - availability：可用性
- 复制：高可用的基础。复制主要实现了数据的多机备份以及对于读操作的负载均衡和简单的故障恢复。缺陷是故障恢复无法自动化、写操作无法负载均衡、存储能力受到单机的限制。
- 哨兵：在复制的基础上，哨兵实现了 **自动化** 的 **故障恢复**。缺陷是 **写操作** 无法 **负载均衡**，**存储能力** 受到 **单机** 的限制。
- 集群：通过集群，`Redis` 解决了 **写操作** 无法 **负载均衡** 以及 **存储能力** 受到 **单机限制** 的问题，实现了较为 **完善** 的 **高可用方案**。

### MySql和Redis缓存一致性

- 缓存一致性方案
  - 触发器
  - canal

**canal工作原理**

- canal 模拟 MySQL slave 的交互协议，伪装自己为 MySQL slave ，向 MySQL master 发送 dump 协议
- MySQL master 收到 dump 请求，开始推送 binary log 给 slave (即 canal )
- canal 解析 binary log 对象(原始为 byte 流)